openapi: 3.1.0
info:
  title: Non-standardized interface. From Workload Supplier/Human Operator to WFM APIs (Kubernetes Manifest Style)
  version: 1.0.0
  description: |
    NOTE: This is not defined by margo. We defined the interfaces to complete the end-to-end story of Margo PoC.
    These APIs are used to manage application workloads.
    1. App package management
    2. Deployments management

servers:
  - url: http://localhost:8082/non-margo/wfm-nbi/api/v0

paths:
  /app-packages:
    post:
      summary: Onboard a new ApplicationPackage
      description: |
        Onboard an application package in manifest style (Kubernetes manifest like).
        The onboarding process is asynchronous and returns immediately with the application package object with a unique identifier in it.
        The workload-supplier uses this API to give info about its Application Registry(Git Repo).
        Note: There is no separate story for Application Registry management, hence we created this suite of APIs to let the WFM know where the app descriptions are hosted.
      operationId: onboardAppPackage
      tags: [Application Packages]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationPackageManifestRequest'
            examples:
              basic:
                summary: Onboarding a manifest-style ApplicationPackage
                value:
                  apiVersion: non-margo.org
                  kind: ApplicationPackage
                  metadata:
                    name: my-web-app-pkg
                    labels:
                      env: dev
                    annotations:
                      description: "A web application for managing user accounts"
                  spec:
                    sourceType: GIT_REPO
                    source:
                      url: "https://github.com/user/my-app.git"
                      branch: "main"
      responses:
        '202':
          description: ApplicationPackage onboarding request accepted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationPackageManifestResp'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - application package already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Unprocessable entity - validation errors
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ErrorResponse'
                  - type: object
                    properties:
                      validationErrors:
                        type: array
                        items:
                          $ref: '#/components/schemas/ValidationError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List ApplicationPackages
      description: Retrieve a paginated list of ApplicationPackages in manifest style.
      operationId: listAppPackages
      tags: [Application Packages]
      parameters:
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, default: 20 }
          description: Maximum number of items to return
        - name: continue
          in: query
          schema: { type: string }
          description: Token for pagination
      responses:
        '200':
          description: List of ApplicationPackages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationPackageListResp'
        '400':
          description: Bad request - invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /app-packages/{id}:
    get:
      summary: Get ApplicationPackage details
      description: Retrieve manifest-style details about a specific ApplicationPackage.
      operationId: getAppPackage
      tags: [Application Packages]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: ID of the ApplicationPackage to retrieve
      responses:
        '200':
          description: ApplicationPackage manifest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationPackageManifestResp'
        '404':
          description: ApplicationPackage not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete ApplicationPackage
      description: |
        Delete an ApplicationPackage from the system. This operation is irreversible.
      operationId: deleteAppPackage
      tags: [Application Packages]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: ID of the ApplicationPackage to delete
        - name: force
          in: query
          schema: { type: boolean, default: false }
          description: Force deletion even if in use
      responses:
        '202':
          description: ApplicationPackage deletion request accepted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationPackageManifestResp'
        '404':
          description: ApplicationPackage not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - cannot delete package in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /app-deployments:
    post:
      summary: Create an ApplicationDeployment
      description: |
        Instantiate an ApplicationDeployment from a cataloged ApplicationPackage, with parameter overrides.
        A human(or some operator) will be responsible of instantiate an application on the onboarded devices.
        Hence this suite of APIs are introduced here.
      operationId: createApplicationDeployment
      tags: [Application Deployments]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationDeploymentManifestRequest'
            examples:
              basic:
                summary: Create a manifest-style ApplicationDeployment
                value:
                  apiVersion: non-margo.org
                  kind: ApplicationDeployment
                  metadata:
                    name: digitron-orchestrator-deployment
                  spec:
                    appPackageRef:
                      id: my-web-app-pkg
                    deviceRef:
                      lable:
                        key: arch
                        value: x86
                    deploymentProfile:
                      type: helm.v3
                      components:
                        - name: digitron-orchestrator
                          properties:
                            repository: oci://northstarida.azurecr.io/charts/northstarida-digitron-orchestrator
                            revision: 1.0.9
                            wait: true
                    parameters:
                      pollFrequency:
                        value: "60"
                        targets:
                          - pointer: settings.pollFrequency
                            components: [digitron-orchestrator]
      responses:
        '202':
          description: ApplicationDeployment creation accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDeploymentManifestResp'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - deployment already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: List ApplicationDeployments
      description: List all ApplicationDeployments in manifest style.
      operationId: listApplicationDeployments
      tags: [Application Deployments]
      parameters:
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, default: 20 }
          description: Maximum number of items to return
        - name: continue
          in: query
          schema: { type: string }
          description: Token for pagination
      responses:
        '200':
          description: List of ApplicationDeployments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDeploymentListResp'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /app-deployments/{id}:
    get:
      summary: Get ApplicationDeployment details
      description: Retrieve manifest-style details about a specific ApplicationDeployment.
      operationId: getApplicationDeployment
      tags: [Application Deployments]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: ID of the ApplicationDeployment to retrieve
      responses:
        '200':
          description: ApplicationDeployment manifest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDeploymentManifestResp'
        '404':
          description: ApplicationDeployment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete ApplicationDeployment
      description: |
        Delete an ApplicationDeployment from the system. This operation is irreversible.
      operationId: deleteApplicationDeployment
      tags: [Application Deployments]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: ID of the ApplicationDeployment to delete
      responses:
        '202':
          description: ApplicationDeployment deletion request accepted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationDeploymentManifestResp'
        '404':
          description: ApplicationDeployment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - cannot delete deployment in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /devices:
    get:
      summary: List Devices
      description: Retrieve a paginated list of devices.
      operationId: listDevices
      tags: [Devices]
      parameters:
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, default: 20 }
          description: Maximum number of items to return
        - name: continue
          in: query
          schema: { type: string }
          description: Token for pagination
      responses:
        '200':
          description: List of Devices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceListResp'
        '400':
          description: Bad request - invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    APIResponse:
      type: object
      properties:
        requestId:
          type: string
          description: Request identifier
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the request
      required: [requestId, timestamp]

    AppDescription:
      description: Application Description manifest
      properties:
        apiVersion:
          default: margo.org/v1-alpha1
          description: API version
          type: string
          # x-go-field-tags: 'json:"apiVersion" yaml:"apiVersion"'
          x-oapi-codegen-extra-tags: 
            json: "apiVersion"
            yaml: "apiVersion"
        configuration:
          $ref: '#/components/schemas/AppConfigurationSchema'
          description: Configuration schema and UI definitions
          # x-go-field-tags: 'json:"configuration" yaml:"configuration"'
          x-oapi-codegen-extra-tags: 
            json: "configuration"
            yaml: "configuration"
        deploymentProfiles:
          description: Available deployment profiles for the application
          items:
            $ref: '#/components/schemas/AppDeploymentProfile'
          type: array
          # x-go-field-tags: 'json:"deploymentProfiles" yaml:"deploymentProfiles"'
          x-oapi-codegen-extra-tags: 
            json: "deploymentProfiles"
            yaml: "deploymentProfiles"
        kind:
          default: ApplicationDescription
          description: Resource kind
          type: string
          # x-go-field-tags: 'json:"kind" yaml:"kind"'
          x-oapi-codegen-extra-tags: 
            json: "kind"
            yaml: "kind"
        metadata:
          $ref: '#/components/schemas/AppDescriptionMetadata'
          description: Application metadata including catalog information
          # x-go-field-tags: 'json:"metadata" yaml:"metadata"'
          x-oapi-codegen-extra-tags: 
            json: "metadata"
            yaml: "metadata"
        parameters:
          $ref: '#/components/schemas/AppDescriptionParametersMap'
          description: Configurable parameters for the application
          # x-go-field-tags: 'json:"parameters" yaml:"parameters"'
          x-oapi-codegen-extra-tags: 
            json: "parameters"
            yaml: "parameters"
      required:
      - apiVersion
      - kind
      - metadata
      - deploymentProfiles
      type: object
    
    AppDescriptionCatalogInfo:
      type: object
      properties:
        application:
          properties:
            descriptionFile:
              description: Path to detailed description file
              type: string
              # x-go-field-tags: 'json:"descriptionFile" yaml:"descriptionFile"'
              x-oapi-codegen-extra-tags: 
                json: "descriptionFile"
                yaml: "descriptionFile"
            icon:
              description: Path to application icon
              type: string
              # x-go-field-tags: 'json:"icon" yaml:"icon"'
              x-oapi-codegen-extra-tags: 
                json: "icon"
                yaml: "icon"
            licenseFile:
              description: Path to license file
              type: string
              # x-go-field-tags: 'json:"licenseFile" yaml:"licenseFile"'
              x-oapi-codegen-extra-tags: 
                json: "licenseFile"
                yaml: "licenseFile"
            releaseNotes:
              description: Path to release notes file
              type: string
              # x-go-field-tags: 'json:"releaseNotes" yaml:"releaseNotes"'
              x-oapi-codegen-extra-tags: 
                json: "releaseNotes"
                yaml: "releaseNotes"
            site:
              description: Application website URL
              format: uri
              type: string
              # x-go-field-tags: 'json:"site" yaml:"site"'
              x-oapi-codegen-extra-tags: 
                json: "site"
                yaml: "site"
            tagline:
              description: Short tagline for the application
              type: string
              # x-go-field-tags: 'json:"tagline" yaml:"tagline"'
              x-oapi-codegen-extra-tags: 
                json: "tagline"
                yaml: "tagline"
            tags:
              description: Tags for categorizing the application
              items:
                type: string
              type: array
              # x-go-field-tags: 'json:"tags" yaml:"tags"'
              x-oapi-codegen-extra-tags: 
                json: "tags"
                yaml: "tags"
          type: object
          # x-go-field-tags: 'json:"application" yaml:"application"'
          x-oapi-codegen-extra-tags: 
            json: "application"
            yaml: "application"
        author:
          # x-go-field-tags: 'json:"author" yaml:"author"'
          x-oapi-codegen-extra-tags: 
            json: "author"
            yaml: "author"
          items:
            properties:
              email:
                description: Author email
                format: email
                type: string
                # x-go-field-tags: 'json:"email" yaml:"email"'
                x-oapi-codegen-extra-tags: 
                  json: "email"
                  yaml: "email"
              name:
                description: Author name
                type: string
                # x-go-field-tags: 'json:"name" yaml:"name"'
                x-oapi-codegen-extra-tags: 
                  json: "name"
                  yaml: "name"
            type: object
          type: array
        organization:
          # x-go-field-tags: 'json:"organization" yaml:"organization"'
          x-oapi-codegen-extra-tags: 
            json: "organization"
            yaml: "organization"
          items:
            properties:
              name:
                description: Organization name
                type: string
                # x-go-field-tags: 'json:"name" yaml:"name"'
                x-oapi-codegen-extra-tags: 
                  json: "name"
                  yaml: "name"
              site:
                description: Organization website
                format: uri
                type: string
                # x-go-field-tags: 'json:"site" yaml:"site"'
                x-oapi-codegen-extra-tags: 
                  json: "site"
                  yaml: "site"
            type: object
          type: array
  
    AppDescriptionMetadata:
      type: object
      properties:
        catalog:
          $ref: '#/components/schemas/AppDescriptionCatalogInfo'
          description: Catalog information for the application
          # x-go-field-tags: 'json:"catalog" yaml:"catalog"'
          x-oapi-codegen-extra-tags: 
            json: "catalog"
            yaml: "catalog"
        description:
          type: string
          description: Description of the application
          # x-go-field-tags: 'json:"description" yaml:"description"'
          x-oapi-codegen-extra-tags: 
            json: "description"
            yaml: "description"
        id:
          type: string
          description: Unique identifier for the application
          example: com-northstartida-digitron-orchestrator
          # x-go-field-tags: 'json:"id" yaml:"id"'
          x-oapi-codegen-extra-tags: 
            json: "id"
            yaml: "id"
        name:
          type: string
          description: Human-readable name of the application
          example: Digitron orchestrator
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
        version:
          type: string
          description: Version of the application
          example: 1.2.1
          # x-go-field-tags: 'json:"version" yaml:"version"'
          x-oapi-codegen-extra-tags: 
            json: "version"
            yaml: "version"
      required:
        - id
        - name
        - version


    AppDeploymentProfile:
      properties:
        components:
          # x-go-field-tags: 'json:"components" yaml:"components"'
          x-oapi-codegen-extra-tags: 
            json: "components"
            yaml: "components"
          description: Components in this deployment profile
          items:
            oneOf:
            - $ref: '#/components/schemas/HelmApplicationDeploymentProfileComponent'
            - $ref: '#/components/schemas/ComposeApplicationDeploymentProfileComponent'
          type: array
        description:
          # x-go-field-tags: 'json:"description" yaml:"description"'
          x-oapi-codegen-extra-tags: 
            json: "description"
            yaml: "description"
          description: Description of the deployment profile
          type: string
        # id:
        #   description: Unique identifier for the deployment profile
        #   type: string
        requiredResources:
          # x-go-field-tags: 'json:"requiredResources" yaml:"requiredResources"'
          x-oapi-codegen-extra-tags: 
            json: "requiredResources"
            yaml: "requiredResources"
          $ref: '#/components/schemas/RequiredResources'
          description: Required resources for this deployment profile
        type:
          # x-go-field-tags: 'json:"type" yaml:"type"'
          x-oapi-codegen-extra-tags: 
            json: "type"
            yaml: "type"
          description: Type of deployment profile
          enum:
          - helm.v3
          - compose
          type: string
      required:
      - type
      # - id
      - components
      type: object

    AppDescriptionParametersMap:
      additionalProperties:
        required:
        - targets
        - value
        properties:
          targets:
            # x-go-field-tags: 'json:"targets" yaml:"targets"'
            x-oapi-codegen-extra-tags: 
              json: "targets"
              yaml: "targets"
            description: Target locations for this parameter
            items:
              $ref: '#/components/schemas/AppParameterTarget'
            type: array
          value:
            # x-go-field-tags: 'json:"value" yaml:"value"'
            x-oapi-codegen-extra-tags: 
              json: "value"
              yaml: "value"
            description: Default value for the parameter
            x-go-type: interface{}
            type: object
            additionalProperties: true
        type: object
      type: object

    AppParameterTarget:
      properties:
        components:
          # x-go-field-tags: 'json:"components" yaml:"components"'
          x-oapi-codegen-extra-tags: 
            json: "components"
            yaml: "components"
          description: Components this target applies to
          items:
            type: string
          type: array
        pointer:
          # x-go-field-tags: 'json:"pointer" yaml:"pointer"'
          x-oapi-codegen-extra-tags: 
            json: "pointer"
            yaml: "pointer"
          description: JSONPath or configuration path
          type: string
      required:
      - pointer
      - components
      type: object

    HelmApplicationDeploymentProfileComponent:
      description: Helm Application Deployment Profile Component
      properties:
        name:
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
          description: Name of the component
          type: string
        properties:
          # x-go-field-tags: 'json:"properties" yaml:"properties"'
          x-oapi-codegen-extra-tags: 
            json: "properties"
            yaml: "properties"
          properties:
            repository:
              # x-go-field-tags: 'json:"repository" yaml:"repository"'
              x-oapi-codegen-extra-tags: 
                json: "repository"
                yaml: "repository"
              description: Repository of the component
              type: string
            revision:
              # x-go-field-tags: 'json:"revision" yaml:"revision"'
              x-oapi-codegen-extra-tags: 
                json: "revision"
                yaml: "revision"
              description: Revision of the component
              type: string
            timeout:
              # x-go-field-tags: 'json:"timeout" yaml:"timeout"'
              x-oapi-codegen-extra-tags: 
                json: "timeout"
                yaml: "timeout"
              description: Timeout for the component
              type: string
            wait:
              # x-go-field-tags: 'json:"wait" yaml:"wait"'
              x-oapi-codegen-extra-tags: 
                json: "wait"
                yaml: "wait"
              description: Wait for the component to be ready
              type: boolean
          required:
          - repository
          type: object
      required:
      - name
      - properties
      type: object

    ComposeApplicationDeploymentProfileComponent:
      description: Compose Application Deployment Profile Component
      properties:
        name:
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
          description: Name of the component
          type: string
        properties:
          # x-go-field-tags: 'json:"properties" yaml:"properties"'
          x-oapi-codegen-extra-tags: 
            json: "properties"
            yaml: "properties"
          properties:
            keyLocation:
              # x-go-field-tags: 'json:"keyLocation" yaml:"keyLocation"'
              x-oapi-codegen-extra-tags: 
                json: "keyLocation"
                yaml: "keyLocation"
              description: Key location of the component
              type: string
            packageLocation:
              # x-go-field-tags: 'json:"packageLocation" yaml:"packageLocation"'
              x-oapi-codegen-extra-tags: 
                json: "packageLocation"
                yaml: "packageLocation"
              description: Package location of the component
              type: string
            timeout:
              # x-go-field-tags: 'json:"timeout" yaml:"timeout"'
              x-oapi-codegen-extra-tags: 
                json: "timeout"
                yaml: "timeout"
              description: Timeout for the component
              type: string
            wait:
              # x-go-field-tags: 'json:"wait" yaml:"wait"'
              x-oapi-codegen-extra-tags: 
                json: "wait"
                yaml: "wait"
              description: Wait for the component to be ready
              type: boolean
          required:
          - packageLocation
          type: object
      required:
      - name
      - properties
      type: object
    
    AppConfigurationSchema:
      properties:
        schema:
          # x-go-field-tags: 'json:"schema" yaml:"schema"'
          x-oapi-codegen-extra-tags: 
            json: "schema"
            yaml: "schema"
          description: Validation schemas for configuration values
          items:
            $ref: '#/components/schemas/ConfigurationSchema'
          type: array
        sections:
          # x-go-field-tags: 'json:"sections" yaml:"sections"'
          x-oapi-codegen-extra-tags: 
            json: "sections"
            yaml: "sections"
          description: Configuration sections for UI organization
          items:
            $ref: '#/components/schemas/ConfigurationSection'
          type: array
      type: object

    ConfigurationSchema:
      properties:
        allowEmpty:
          # x-go-field-tags: 'json:"allowEmpty" yaml:"allowEmpty"'
          x-oapi-codegen-extra-tags: 
            json: "allowEmpty"
            yaml: "allowEmpty"
          description: Whether empty values are allowed
          type: boolean
        dataType:
          # x-go-field-tags: 'json:"dataType" yaml:"dataType"'
          x-oapi-codegen-extra-tags: 
            json: "dataType"
            yaml: "dataType"
          description: Data type for validation
          enum:
          - string
          - integer
          - double
          - boolean
          type: string
        maxLength:
          # x-go-field-tags: 'json:"maxLength" yaml:"maxLength"'
          x-oapi-codegen-extra-tags: 
            json: "maxLength"
            yaml: "maxLength"
          description: Maximum length for strings
          type: integer
        maxPrecision:
          # x-go-field-tags: 'json:"maxPrecision" yaml:"maxPrecision"'
          x-oapi-codegen-extra-tags: 
            json: "maxPrecision"
            yaml: "maxPrecision"
          description: Maximum decimal precision for doubles
          type: integer
        maxValue:
          # x-go-field-tags: 'json:"maxValue" yaml:"maxValue"'
          x-oapi-codegen-extra-tags: 
            json: "maxValue"
            yaml: "maxValue"
          description: Maximum value for numbers
          type: number
        minLength:
          # x-go-field-tags: 'json:"minLength" yaml:"minLength"'
          x-oapi-codegen-extra-tags: 
            json: "minLength"
            yaml: "minLength"
          description: Minimum length for strings
          type: integer
        minValue:
          # x-go-field-tags: 'json:"minValue" yaml:"minValue"'
          x-oapi-codegen-extra-tags: 
            json: "minValue"
            yaml: "minValue"
          description: Minimum value for numbers
          type: number
        name:
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
          description: Schema name
          type: string
        regexMatch:
          # x-go-field-tags: 'json:"regexMatch" yaml:"regexMatch"'
          x-oapi-codegen-extra-tags: 
            json: "regexMatch"
            yaml: "regexMatch"
          description: Regular expression for validation
          type: string
      required:
      - name
      - dataType
      type: object

    ConfigurationSection:
      properties:
        name:
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
          description: Name of the configuration section
          type: string
        settings:
          # x-go-field-tags: 'json:"settings" yaml:"settings"'
          x-oapi-codegen-extra-tags: 
            json: "settings"
            yaml: "settings"
          description: Settings in this section
          items:
            $ref: '#/components/schemas/ConfigurationSetting'
          type: array
      required:
      - name
      - settings
      type: object

    ConfigurationSetting:
      properties:
        description:
          # x-go-field-tags: 'json:"description" yaml:"description"'
          x-oapi-codegen-extra-tags: 
            json: "description"
            yaml: "description"
          description: Description of the setting
          type: string
        immutable:
          # x-go-field-tags: 'json:"immutable" yaml:"immutable"'
          x-oapi-codegen-extra-tags: 
            json: "immutable"
            yaml: "immutable"
          description: Whether the setting can be changed after deployment
          type: boolean
        name:
          # x-go-field-tags: 'json:"name" yaml:"name"'
          x-oapi-codegen-extra-tags: 
            json: "name"
            yaml: "name"
          description: Display name for the setting
          type: string
        parameter:
          # x-go-field-tags: 'json:"parameter" yaml:"parameter"'
          x-oapi-codegen-extra-tags: 
            json: "parameter"
            yaml: "parameter"
          description: Parameter name reference
          type: string
        schema:
          # x-go-field-tags: 'json:"schema" yaml:"schema"'
          x-oapi-codegen-extra-tags: 
            json: "schema"
            yaml: "schema"
          description: Reference to validation schema
          type: string
      required:
      - parameter
      - name
      - schema
      type: object
    
    RequiredResources:
      properties:
        cpu:
          # x-go-field-tags: 'json:"cpu" yaml:"cpu"'
          x-oapi-codegen-extra-tags: 
            json: "cpu"
            yaml: "cpu"
          properties:
            architectures:
              # x-go-field-tags: 'json:"architectures" yaml:"architectures"'
              x-oapi-codegen-extra-tags: 
                json: "architectures"
                yaml: "architectures"
              description: Supported CPU architectures
              items:
                type: string
              type: array
            cores:
              # x-go-field-tags: 'json:"cores" yaml:"cores"'
              x-oapi-codegen-extra-tags: 
                json: "cores"
                yaml: "cores"
              description: Required CPU cores
              type: number
          type: object
        interfaces:
          # x-go-field-tags: 'json:"interfaces" yaml:"interfaces"'
          x-oapi-codegen-extra-tags: 
            json: "interfaces"
            yaml: "interfaces"
          items:
            properties:
              type:
                # x-go-field-tags: 'json:"type" yaml:"type"'
                x-oapi-codegen-extra-tags: 
                  json: "type"
                  yaml: "type"
                description: Interface type (e.g., ethernet, bluetooth)
                type: string
            type: object
          type: array
        memory:
          # x-go-field-tags: 'json:"memory" yaml:"memory"'
          x-oapi-codegen-extra-tags: 
            json: "memory"
            yaml: "memory"
          description: Required memory (e.g., "1024Mi")
          type: string
        peripherals:
          # x-go-field-tags: 'json:"peripherals" yaml:"peripherals"'
          x-oapi-codegen-extra-tags: 
            json: "peripherals"
            yaml: "peripherals"
          items:
            properties:
              manufacturer:
                # x-go-field-tags: 'json:"manufacturer" yaml:"manufacturer"'
                x-oapi-codegen-extra-tags: 
                  json: "manufacturer"
                  yaml: "manufacturer"
                description: Manufacturer requirement
                type: string
              type:
                # x-go-field-tags: 'json:"type" yaml:"type"'
                x-oapi-codegen-extra-tags: 
                  json: "type"
                  yaml: "type"
                description: Type of peripheral
                type: string
            type: object
          type: array
        storage:
          # x-go-field-tags: 'json:"storage" yaml:"storage"'
          x-oapi-codegen-extra-tags: 
            json: "storage"
            yaml: "storage"
          description: Required storage (e.g., "10Gi")
          type: string
      type: object


    # Application Package Schemas
    ApplicationPackageManifestRequest:
      type: object
      description: Application Package manifest
      required: [apiVersion, kind, metadata, spec]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: ApplicationPackage
          description: Resource kind
        metadata:
          type: object
          required: [name]
          properties:
            name:
              type: string
              description: Name of the resource
            namespace:
              type: string
              description: Namespace of the resource
            labels:
              type: object
              additionalProperties: { type: string }
              description: Labels for the resource
            annotations:
              type: object
              additionalProperties: { type: string }
              description: Annotations for the resource
        spec:
          $ref: '#/components/schemas/ApplicationPackageSpec'
          description: Specification of the package
    
    # Application Package Schemas
    ApplicationPackageManifestResp:
      type: object
      description: Application Package manifest
      required: [apiVersion, kind, metadata, spec]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: ApplicationPackage
          description: Resource kind
        metadata:
          $ref: '#/components/schemas/Metadata'
          description: Metadata of the package
        spec:
          $ref: '#/components/schemas/ApplicationPackageSpec'
          description: Specification of the package
        recentOperation:
          $ref: '#/components/schemas/ApplicationPackageRecentOperation'
          description: Recent operation details
        status:
          $ref: '#/components/schemas/ApplicationPackageStatus'
          description: Status of the package

    ApplicationPackageListResp:
      type: object
      description: List of Application Packages
      required: [apiVersion, kind, items]
      properties:
        apiVersion:
          type: string
          description: API version
        kind:
          type: string
          default: ApplicationPackageList
        metadata:
          type: object
          $ref: '#/components/schemas/PaginationMetadata'
        items:
          type: array
          items:
            $ref: '#/components/schemas/ApplicationPackageManifestResp'

    ApplicationDeploymentManifestRequest:
      type: object
      description: Application Deployment request
      required: [apiVersion, kind, metadata, spec]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: ApplicationDeployment
          description: Resource kind
        metadata:
          type: object
          required: [name]
          properties:
            id:
              type: string
              readOnly: true
              description: This field is generated by the server.
            name:
              type: string
              description: Name of the deployment
            namespace:
              type: string
              description: Namespace of the deployment
            labels:
              type: object
              additionalProperties: { type: string }
              description: Labels for the deployment
            annotations:
              type: object
              additionalProperties: { type: string }
              description: Annotations for the deployment
            creationTimestamp:
              type: string
              format: date-time
              readOnly: true
              description: Creation timestamp
        spec:
          $ref: '#/components/schemas/ApplicationDeploymentSpec'
          description: Specification of the deployment


    # Application Deployment Schemas
    ApplicationDeploymentManifestResp:
      type: object
      description: Application Deployment manifest
      required: [apiVersion, kind, metadata, spec]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: ApplicationDeployment
          description: Resource kind
        metadata:
          $ref: '#/components/schemas/Metadata'
        spec:
          $ref: '#/components/schemas/ApplicationDeploymentSpec'
        status:
          $ref: '#/components/schemas/ApplicationDeploymentStatus'
          description: Status of the deployment
        recentOperation:
          $ref: '#/components/schemas/ApplicationDeploymentRecentOperation'
          description: Recent operation details

    ApplicationDeploymentListResp:
      type: object
      description: List of Application Deployments
      required: [apiVersion, kind, metadata, items]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: ApplicationDeploymentList
          description: Resource kind
        metadata:
          type: object
          $ref: '#/components/schemas/PaginationMetadata'
        items:
          type: array
          items:
            $ref: '#/components/schemas/ApplicationDeploymentManifestResp'

    ApplicationDeploymentOperation:
      type: string
      enum: [DEPLOY, DELETE, UPDATE]
      description: Current application deployment operation

    ApplicationDeploymentOperationStatus:
      type: string
      enum: [PENDING, PROCESSING, COMPLETED, FAILED, CANCELLED]
      description: Current state of the application deployment operation

    ApplicationDeploymentRecentOperation:
      type: object
      required: [op, status]
      readOnly: true
      properties:
        op:
          $ref: '#/components/schemas/ApplicationDeploymentOperation'
          description: The operation being performed
        status:
          $ref: '#/components/schemas/ApplicationDeploymentOperationStatus'
          description: The status of the operation

    ApplicationDeploymentSpec:
      type: object
      description: Application Deployment specification
      required: [appPackageRef, deploymentProfile]
      properties:
        appPackageRef:
          type: object
          required: [id]
          properties:
            id:
              type: string
              description: ID of the ApplicationPackage
        deviceRef:
          type: object
          oneOf:
            - required: [id]
            - required: [labels]
          properties:
            id:
              type: string
              description: ID of the Device
            labels:
              type: object
              additionalProperties: true
              description: Labels for the Device
        deploymentProfile:
          $ref: '#/components/schemas/DeploymentExecutionProfile'
          description: Deployment profile
        parameters:
          $ref: '#/components/schemas/DeploymentParameters'
          description: Parameters for the deployment

    ApplicationDeploymentStatus:
      type: object
      description: Application Deployment status
      required: [state]
      properties:
        state:
          type: string
          enum: [PENDING, INSTALLING, INSTALLED, REMOVING, REMOVED, FAILED, UPDATING, UPDATED]
          example: PENDING
          description: State of the deployment
          readOnly: true
        contextualInfo:
          $ref: '#/components/schemas/ContextualInfo'
          description: Contextual information
          readOnly: true
        lastUpdateTime:
          type: string
          format: date-time
          description: Last update time
          readOnly: true

    DeploymentExecutionProfile:
      type: object
      description: Application Deployment Profile
      required: [type, components]
      properties:
        type:
          type: string
          enum: ["helm.v3", "compose"]
          description: Type of deployment profile
        components:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/HelmDeploymentProfileComponent'
              - $ref: '#/components/schemas/ComposeDeploymentProfileComponent'
          description: Components of the deployment profile

    HelmDeploymentProfileComponent:
      type: object
      description: Helm Application Deployment Profile Component
      required: [name, properties]
      properties:
        name:
          type: string
          description: Name of the component
        properties:
          type: object
          required: [repository]
          properties:
            repository:
              type: string
              description: Repository of the component
            revision:
              type: string
              description: Revision of the component
            timeout:
              type: string
              description: Timeout for the component
            wait:
              type: boolean
              description: Wait for the component to be ready

    ComposeDeploymentProfileComponent:
      type: object
      description: Compose Application Deployment Profile Component
      required: [name, properties]
      properties:
        name:
          type: string
          description: Name of the component
        properties:
          type: object
          required: [packageLocation]
          properties:
            packageLocation:
              type: string
              description: Package location of the component
            keyLocation:
              type: string
              description: Key location of the component
            timeout:
              type: string
              description: Timeout for the component
            wait:
              type: boolean
              description: Wait for the component to be ready

    DeploymentParameterTarget:
      type: object
      description: Application Parameter Target
      required: [pointer, components]
      properties:
        pointer:
          type: string
          description: Pointer to the parameter
        components:
          type: array
          items:
            type: string
          description: Components of the parameter

    DeploymentParameterValue:
      type: object
      description: Application Parameter Value
      required: [value, targets]
      properties:
        value:
          type: object
          description: Value of the parameter
          additionalProperties: true
          x-go-type: interface{}
        targets:
          type: array
          items:
            $ref: '#/components/schemas/DeploymentParameterTarget'
          description: Targets of the parameter

    DeploymentParameters:
      type: object
      description: Application Parameters
      additionalProperties:
        $ref: '#/components/schemas/DeploymentParameterValue'

    ApplicationPackageOperation:
      type: string
      enum: [ONBOARD, DEBOARD, STAGE, UNSTAGE]
      description: Current application package operation

    ApplicationPackageOperationStatus:
      type: string
      enum: [PENDING, PROCESSING, COMPLETED, FAILED, CANCELLED]
      description: Current state of the application package operation

    ApplicationPackageRecentOperation:
      type: object
      required: [op, status]
      readOnly: true
      properties:
        op:
          $ref: '#/components/schemas/ApplicationPackageOperation'
          description: The operation being performed
        status:
          $ref: '#/components/schemas/ApplicationPackageOperationStatus'
          description: The status of the operation

    ApplicationPackageSpec:
      type: object
      description: Application Package specification
      required: [sourceType, source]
      properties:
        sourceType:
          type: string
          enum:
            - GIT_REPO
          description: Type of source for the application package
        source:
          oneOf:
            - $ref: '#/components/schemas/GitRepo'
          description: Source configuration based on sourceType
    
    GitRepo:
      type: object
      description: Git repository source configuration
      properties:
        url:
          type: string
          format: uri
          description: Git repository URL (only HTTPS is supported)
          pattern: '^(https?://|git@).*\.git$'
          example: "https://github.com/user/my-app.git"
        branch:
          type: string
          description: Git branch to use
          pattern: '^[a-zA-Z0-9/_\-\.]+$'
          minLength: 1
          maxLength: 100
          example: "main"
        tag:
          type: string
          description: Git tag to use (alternative to branch)
          pattern: '^[a-zA-Z0-9/_\-\.]+$'
          minLength: 1
          maxLength: 100
          example: "v1.0.0"
        username:
          type: string
          description: Git username for authentication
          minLength: 1
          maxLength: 100
          example: "git-user"
        accessToken:
          type: string
          description: Git access token for authentication
          format: password
          minLength: 1
          maxLength: 200
        subPath:
          type: string
          description: Subdirectory within the repository containing the application description yaml (ex margo.yaml)
          pattern: '^[a-zA-Z0-9/_\-\.]+$'
          maxLength: 200
          example: "apps/web-service"
      required: [url]
      oneOf:
        - required: [branch]
        - required: [tag]

    ApplicationPackageStatus:
      type: object
      required: [state]
      properties:
        state:
          type: string
          enum: [PENDING, ONBOARDED, DEBOARDED, FAILED, STAGED, UNSTAGED]
          example: ONBOARDED
          description: State of the application package
          readOnly: true
        contextualInfo:
          $ref: '#/components/schemas/ContextualInfo'
          description: Contextual information
          readOnly: true
        lastUpdateTime:
          type: string
          format: date-time
          description: Last update time
          readOnly: true

    DeviceListResp:
      type: object
      description: List of Devices
      required: [apiVersion, kind, items]
      properties:
        apiVersion:
          type: string
          description: API version
        kind:
          type: string
          default: DeviceList
        metadata:
          type: object
          $ref: '#/components/schemas/PaginationMetadata'
        items:
          type: array
          items:
            $ref: '#/components/schemas/DeviceManifestResp'
    
    # Device Schemas
    DeviceManifestResp:
      type: object
      description: Device manifest
      required: [apiVersion, kind, metadata, spec, state]
      properties:
        apiVersion:
          type: string
          default: non-margo.org
          description: API version
        kind:
          type: string
          default: Device
          description: Resource kind
        metadata:
          $ref: '#/components/schemas/Metadata'
          description: Metadata of the device
        spec:
          $ref: '#/components/schemas/DeviceSpec'
          description: Specification of the device
        state:
          $ref: '#/components/schemas/DeviceState'
          description: State of the device
    
    DeviceSpec:
      type: object
      required: [signature, capabilities]
      properties:
        signature:
          type: string
          description: Unique signature of the device
        capabilities:
          # type: object
          x-go-type: interface{}
          type: object
          additionalProperties: true
    
    DeviceState:
      type: object
      required: [onboard]
      properties:
        onboard:
          $ref: '#/components/schemas/DeviceOnboardStatus'
    
    DeviceOnboardStatus:
      type: string
      enum: [IN-PROGRESS, ONBOARDED, FAILED]

    # Common Schemas
    ContextualInfo:
      type: object
      readOnly: true
      properties:
        code:
          type: string
          description: Code of the contextual information
        message:
          type: string
          description: Message of the contextual information

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/APIResponse'
        - type: object
          properties:
            errorCode:
              type: string
              description: Error code
            details:
              type: object
              additionalProperties: true
              description: Additional details about the error
          required: [errorCode]

    Metadata:
      type: object
      required: [name]
      properties:
        id:
          type: string
          readOnly: true
          description: This field is generated by the server.
        name:
          type: string
          description: Name of the resource
        namespace:
          type: string
          description: Namespace of the resource
        labels:
          type: object
          additionalProperties: { type: string }
          description: Labels for the resource
        annotations:
          type: object
          additionalProperties: { type: string }
          description: Annotations for the resource
        creationTimestamp:
          type: string
          format: date-time
          readOnly: true
          description: Creation timestamp

    PaginationMetadata:
      type: object
      properties:
        continue:
          type: boolean
          description: Indicates if there are more items to retrieve
        remainingItemCount:
          type: integer
          description: Number of items remaining

    ValidationError:
      type: object
      properties:
        field:
          type: string
          description: Field with the validation error
        message:
          type: string
          description: Validation error message
      required: [field, message]

security:
  - BearerAuth: []
  - ApiKeyAuth: []

tags:
  - name: Application Packages
    description: Operations for managing application packages
  - name: Application Deployments
    description: Operations for managing application deployments